<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="jquery/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <nav class="navigation">
        <div class="navigation__column">
            <a href='#'>
                <img src='img/instagram_logo.png'>
            </a>
        </div>
        <div class="navigation__column">
            <i class="fa fa-search"></i>
            <input type="text" placeholder="Search">
        </div>
        <div class="navigation__column">
            <ul class="navigation__links">
                <li class="navigation__list-item">
                    <a href="#" class="navigation__link">
                        <i class="fa fa-compass fa-lg"></i>
                    </a>
                </li>
                <li class="navigation__list-item">
                    <a href="#" class="navigation__link">
                        <i class="fa fa-heart-o fa-lg"></i>
                    </a>
                </li>
                <li class="navigation__list-item">
                    <a href="#" class="navigation__link">
                        <i class="fa fa-user-o fa-lg"></i>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <main id="profile">
        <header class="profile__header">
            <div class="profile__column">
                <img src="img/blank_avatar.png">
            </div>
            <div class="profile__column">
                <div class="profile__title">
                    <h3 class="profile__username">Junse_94</h3>
                    <a href="#">Edit profile</a>
                    <i class="fa fa-cog fa-lg"></i>
                </div>
                <ul class="profile__stats">
                    <li class="profile__stat">
                        <span class="stat__number posts">4</span> posts
                    </li>
                    <li class="profile__stat">
                        <span class="stat__number followers">50</span> followers
                    </li>
                    <li class="profile__stat">
                        <span class="stat__number follows">50</span> follows
                    </li>
                </ul>
                <p class="profile__bio">
                    <span class="profile__full-name">
                        Yoon Jun Seok
                    </span>
                </p>
            </div>
        </header>
        <section class="profile__photos">
            <div class="col-md-4 profile__photo w_long">
                <img src="img/feedPhoto/1.png">
            </div>
            <div class="col-md-4 profile__photo w_long">
                <img src="img/feedPhoto/2.png">
            </div>
            <div class="profile__photo empty__photo">
                <i class="fa fa-plus-circle" id="browser_img_input"></i>
            </div>
            <input type="file" id="img_input" accept="img/*" required multiple>
        </section>
    </main>
    <footer>
    </footer>
</body>

</html>

<script type="text/javascript">
    // when browser's plus btn is clicked, real input file works.  
    const browse_img_input_btn = $('#browser_img_input');
    const real_img_input_btn = $('#img_input');
    browse_img_input_btn.on('click', function () {
        real_img_input_btn.click();
    });

    function getPostNum() {
        var post_num = 0;
        $('.profile__photo').each(function () {
            post_num++;
        });
        return post_num;
    }

    function getPostForm(index, result, name) {
        var post_form = `<div class="col-md-4 profile__photo" id="${index}">\
            <img src = ${result} data-file="${name}" >\
        </div >\
        `
        return post_form
    }

    function addNewPost(e) {
        var empty_post_form = '<div class="profile__photo empty__photo">\
            <i class="fa fa-plus-circle" id="browser_img_input"></i>\
        </div>\
        '
        // collect input's files
        var self_files = [];
        var files = e.target.files;
        var fileArr = Array.prototype.slice.call(files);

        // count the number of posts that will be used for post's id.
        var post_num = getPostNum();

        fileArr.forEach(function (f) {
            if (!f.type.match("image/.*")) {
                alert("이미지 파일만 업로드 가능합니다.");
                return;
            };
            // limit the maximum # of photos that users can upload.
            if (files.length < 11) {
                self_files.push(f);
                var reader = new FileReader();
                reader.onload = function (e) {
                    // empty post delete > new post append > empty post append 
                    $('.empty__photo').remove();
                    $('.profile__photos').append(getPostForm(post_num, e.target.result, f.name));
                    $('.profile__photos').append(empty_post_form)
                };
                reader.readAsDataURL(f);
            }
        })
        // limit the maximum # of photos that users can upload.
        if (files.length > 11) {
            alert("최대 10장까지만 업로드 할 수 있습니다.");
        }
        $('.post').text(post_num);
    }

    $('#img_input').on('change', addNewPost);
</script>